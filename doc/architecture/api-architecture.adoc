= API Architecture Document
:toc: macro
:toclevels: 3
:sectnums:

toc::[]

== 1. Introduction

=== 1.1 Purpose

This document describes the API architecture of the OSSNetwork system, including endpoint design, request/response formats, authentication, and API conventions.

=== 1.2 Scope

This document covers:

* RESTful API design principles
* Endpoint specifications and contracts
* Authentication and authorization
* Request/response formats and conventions
* Error handling and status codes
* API versioning strategy

== 2. API Overview

=== 2.1 API Characteristics

* *Style*: RESTful API
* *Protocol*: HTTP/HTTPS
* *Format*: JSON
* *Authentication*: JWT (JSON Web Tokens)
* *Documentation*: OpenAPI/Swagger (auto-generated)
* *Base URL*: `/api/v1`

=== 2.2 API Principles

* *Resource-Oriented*: URLs represent resources, not actions
* *Standard HTTP Methods*: GET, POST, PUT, PATCH, DELETE
* *Stateless*: Each request contains all necessary information
* *Idempotent Operations*: Safe retries for GET, PUT, DELETE
* *Consistent Naming*: Plural nouns for collections
* *Versioned*: API version in URL path

== 3. API Structure

=== 3.1 URL Structure

[source]
----
https://api.ossnetwork.com/api/v1/{resource}/{id}/{sub-resource}
                           |    |   |          |    |
                           |    |   |          |    └─ Sub-resource
                           |    |   |          └─ Resource ID
                           |    |   └─ Resource name (plural)
                           |    └─ API version
                           └─ API base path
----

=== 3.2 Endpoint Categories

[cols="1,2,2"]
|===
| Category | Path Prefix | Description

| *Authentication*
| `/api/v1/auth`
| User authentication and session management

| *Users*
| `/api/v1/users`
| User profile and account management

| *Projects*
| `/api/v1/projects`
| Project CRUD and discovery

| *Contributions*
| `/api/v1/contributions`
| Contribution requests and tracking

| *Tags*
| `/api/v1/tags`
| Technology tags and categories

| *Notifications*
| `/api/v1/notifications`
| User notifications
|===

== 4. Authentication API

=== 4.1 User Registration

*Endpoint*: `POST /api/v1/auth/register`

*Request*:
[source,json]
----
{
  "email": "user@example.com",
  "username": "johndoe",
  "password": "SecurePassword123!",
  "bio": "Full-stack developer passionate about open source",
  "tech_stack": ["Python", "JavaScript", "Vue.js"]
}
----

*Response* (201 Created):
[source,json]
----
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "email": "user@example.com",
  "username": "johndoe",
  "bio": "Full-stack developer passionate about open source",
  "tech_stack": ["Python", "JavaScript", "Vue.js"],
  "created_at": "2026-01-18T10:30:00Z"
}
----

*Validation Rules*:
* Email: Valid format, unique
* Username: 3-50 characters, alphanumeric with underscores, unique
* Password: Minimum 8 characters, at least one uppercase, one lowercase, one number
* Tech stack: Array of strings, max 10 items

=== 4.2 User Login

*Endpoint*: `POST /api/v1/auth/login`

*Request*:
[source,json]
----
{
  "email": "user@example.com",
  "password": "SecurePassword123!"
}
----

*Response* (200 OK):
[source,json]
----
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 3600,
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "username": "johndoe"
  }
}
----

=== 4.3 Refresh Token

*Endpoint*: `POST /api/v1/auth/refresh`

*Request*:
[source,json]
----
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
----

*Response* (200 OK):
[source,json]
----
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 3600
}
----

=== 4.4 Get Current User

*Endpoint*: `GET /api/v1/auth/me`

*Headers*: `Authorization: Bearer <token>`

*Response* (200 OK):
[source,json]
----
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "email": "user@example.com",
  "username": "johndoe",
  "github_handle": "johndoe",
  "bio": "Full-stack developer passionate about open source",
  "tech_stack": ["Python", "JavaScript", "Vue.js"],
  "created_at": "2026-01-18T10:30:00Z",
  "last_login": "2026-01-18T15:45:00Z"
}
----

=== 4.5 Logout

*Endpoint*: `POST /api/v1/auth/logout`

*Headers*: `Authorization: Bearer <token>`

*Response* (204 No Content)

== 5. Projects API

=== 5.1 List Projects

*Endpoint*: `GET /api/v1/projects`

*Query Parameters*:
* `page` (integer, default: 1): Page number
* `per_page` (integer, default: 20, max: 100): Items per page
* `help_wanted` (boolean): Filter by help wanted status
* `tags` (string, comma-separated): Filter by tags
* `search` (string): Full-text search in title and description
* `sort` (string): Sort field (created_at, updated_at, title)
* `order` (string): Sort order (asc, desc)

*Response* (200 OK):
[source,json]
----
{
  "data": [
    {
      "id": "650e8400-e29b-41d4-a716-446655440001",
      "title": "Awesome Open Source Project",
      "description": "A revolutionary project that solves real problems",
      "repository_url": "https://github.com/user/awesome-project",
      "help_wanted": true,
      "status": "active",
      "tags": ["Python", "FastAPI", "Docker"],
      "contributor_count": 5,
      "owner": {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "username": "johndoe"
      },
      "created_at": "2026-01-15T10:00:00Z",
      "updated_at": "2026-01-18T14:30:00Z"
    }
  ],
  "meta": {
    "page": 1,
    "per_page": 20,
    "total_items": 45,
    "total_pages": 3
  },
  "links": {
    "self": "/api/v1/projects?page=1",
    "next": "/api/v1/projects?page=2",
    "last": "/api/v1/projects?page=3"
  }
}
----

=== 5.2 Get Project Details

*Endpoint*: `GET /api/v1/projects/{project_id}`

*Response* (200 OK):
[source,json]
----
{
  "id": "650e8400-e29b-41d4-a716-446655440001",
  "title": "Awesome Open Source Project",
  "description": "A revolutionary project that solves real problems",
  "repository_url": "https://github.com/user/awesome-project",
  "help_wanted": true,
  "status": "active",
  "tags": ["Python", "FastAPI", "Docker"],
  "contributor_count": 5,
  "owner": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "username": "johndoe",
    "github_handle": "johndoe",
    "bio": "Full-stack developer"
  },
  "contributors": [
    {
      "id": "750e8400-e29b-41d4-a716-446655440002",
      "username": "janesmith",
      "role": "contributor",
      "contribution_status": "in_progress"
    }
  ],
  "created_at": "2026-01-15T10:00:00Z",
  "updated_at": "2026-01-18T14:30:00Z"
}
----

=== 5.3 Create Project

*Endpoint*: `POST /api/v1/projects`

*Headers*: `Authorization: Bearer <token>`

*Request*:
[source,json]
----
{
  "title": "New Amazing Project",
  "description": "Detailed project description with goals and requirements",
  "repository_url": "https://github.com/user/new-project",
  "help_wanted": true,
  "tags": ["JavaScript", "React", "Node.js"]
}
----

*Response* (201 Created):
[source,json]
----
{
  "id": "850e8400-e29b-41d4-a716-446655440003",
  "title": "New Amazing Project",
  "description": "Detailed project description with goals and requirements",
  "repository_url": "https://github.com/user/new-project",
  "help_wanted": true,
  "status": "active",
  "tags": ["JavaScript", "React", "Node.js"],
  "contributor_count": 0,
  "owner": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "username": "johndoe"
  },
  "created_at": "2026-01-18T16:00:00Z",
  "updated_at": "2026-01-18T16:00:00Z"
}
----

*Validation Rules*:
* Title: Required, 5-200 characters
* Description: Required, 50-5000 characters
* Repository URL: Valid GitHub URL, unique
* Tags: Array of 1-10 strings

=== 5.4 Update Project

*Endpoint*: `PUT /api/v1/projects/{project_id}`

*Headers*: `Authorization: Bearer <token>`

*Authorization*: Only project owner can update

*Request*:
[source,json]
----
{
  "title": "Updated Project Title",
  "description": "Updated description",
  "help_wanted": false,
  "status": "active"
}
----

*Response* (200 OK): Updated project object

=== 5.5 Delete Project

*Endpoint*: `DELETE /api/v1/projects/{project_id}`

*Headers*: `Authorization: Bearer <token>`

*Authorization*: Only project owner can delete

*Response* (204 No Content)

=== 5.6 Get Project Contributors

*Endpoint*: `GET /api/v1/projects/{project_id}/contributors`

*Response* (200 OK):
[source,json]
----
{
  "data": [
    {
      "user": {
        "id": "750e8400-e29b-41d4-a716-446655440002",
        "username": "janesmith",
        "github_handle": "janesmith",
        "tech_stack": ["Python", "Django"]
      },
      "role": "contributor",
      "contribution_status": "in_progress",
      "joined_at": "2026-01-16T12:00:00Z"
    }
  ]
}
----

== 6. Contributions API

=== 6.1 Request Contribution

*Endpoint*: `POST /api/v1/contributions`

*Headers*: `Authorization: Bearer <token>`

*Request*:
[source,json]
----
{
  "project_id": "650e8400-e29b-41d4-a716-446655440001",
  "notes": "I'm interested in contributing. I have experience with Python and FastAPI."
}
----

*Response* (201 Created):
[source,json]
----
{
  "id": "950e8400-e29b-41d4-a716-446655440004",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "project_id": "650e8400-e29b-41d4-a716-446655440001",
  "status": "interested",
  "notes": "I'm interested in contributing. I have experience with Python and FastAPI.",
  "requested_at": "2026-01-18T16:30:00Z",
  "created_at": "2026-01-18T16:30:00Z",
  "updated_at": "2026-01-18T16:30:00Z"
}
----

=== 6.2 Update Contribution Status

*Endpoint*: `PUT /api/v1/contributions/{contribution_id}`

*Headers*: `Authorization: Bearer <token>`

*Authorization*: Project owner or contributor

*Request*:
[source,json]
----
{
  "status": "in_progress",
  "notes": "Started working on issue #42"
}
----

*Response* (200 OK): Updated contribution object

*Status Transitions*:
* `interested` → `in_progress` (by project owner)
* `in_progress` → `merged` (by project owner)
* `merged` → `completed` (by project owner)
* Any status → `cancelled` (by contributor or owner)

=== 6.3 Get User Contributions

*Endpoint*: `GET /api/v1/users/{user_id}/contributions`

*Query Parameters*:
* `status` (string): Filter by status
* `page`, `per_page`: Pagination

*Response* (200 OK):
[source,json]
----
{
  "data": [
    {
      "id": "950e8400-e29b-41d4-a716-446655440004",
      "project": {
        "id": "650e8400-e29b-41d4-a716-446655440001",
        "title": "Awesome Open Source Project",
        "repository_url": "https://github.com/user/awesome-project"
      },
      "status": "in_progress",
      "requested_at": "2026-01-18T16:30:00Z",
      "started_at": "2026-01-18T17:00:00Z"
    }
  ],
  "meta": {
    "page": 1,
    "per_page": 20,
    "total_items": 3
  }
}
----

== 7. Users API

=== 7.1 Get User Profile

*Endpoint*: `GET /api/v1/users/{user_id}`

*Response* (200 OK):
[source,json]
----
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "username": "johndoe",
  "github_handle": "johndoe",
  "bio": "Full-stack developer passionate about open source",
  "tech_stack": ["Python", "JavaScript", "Vue.js"],
  "projects_owned": 3,
  "contributions_count": 12,
  "created_at": "2026-01-10T08:00:00Z"
}
----

=== 7.2 Update User Profile

*Endpoint*: `PUT /api/v1/users/{user_id}`

*Headers*: `Authorization: Bearer <token>`

*Authorization*: Only the user themselves

*Request*:
[source,json]
----
{
  "bio": "Updated bio text",
  "tech_stack": ["Python", "JavaScript", "Vue.js", "Docker"],
  "github_handle": "johndoe"
}
----

*Response* (200 OK): Updated user object

== 8. Tags API

=== 8.1 List Tags

*Endpoint*: `GET /api/v1/tags`

*Query Parameters*:
* `category` (string): Filter by category
* `search` (string): Search by name

*Response* (200 OK):
[source,json]
----
{
  "data": [
    {
      "id": "a50e8400-e29b-41d4-a716-446655440010",
      "name": "Python",
      "category": "language",
      "project_count": 234
    },
    {
      "id": "b50e8400-e29b-41d4-a716-446655440011",
      "name": "FastAPI",
      "category": "framework",
      "project_count": 89
    }
  ]
}
----

=== 8.2 Get Popular Tags

*Endpoint*: `GET /api/v1/tags/popular`

*Query Parameters*:
* `limit` (integer, default: 10): Number of tags to return

*Response* (200 OK): List of most used tags

== 9. Notifications API

=== 9.1 List Notifications

*Endpoint*: `GET /api/v1/notifications`

*Headers*: `Authorization: Bearer <token>`

*Query Parameters*:
* `is_read` (boolean): Filter by read status
* `type` (string): Filter by notification type
* `page`, `per_page`: Pagination

*Response* (200 OK):
[source,json]
----
{
  "data": [
    {
      "id": "c50e8400-e29b-41d4-a716-446655440020",
      "type": "contribution_approved",
      "message": "Your contribution request for 'Awesome Project' has been approved!",
      "metadata": {
        "project_id": "650e8400-e29b-41d4-a716-446655440001",
        "contribution_id": "950e8400-e29b-41d4-a716-446655440004"
      },
      "is_read": false,
      "created_at": "2026-01-18T17:00:00Z"
    }
  ],
  "unread_count": 5
}
----

=== 9.2 Mark Notification as Read

*Endpoint*: `PUT /api/v1/notifications/{notification_id}/read`

*Headers*: `Authorization: Bearer <token>`

*Response* (200 OK): Updated notification object

=== 9.3 Mark All as Read

*Endpoint*: `POST /api/v1/notifications/read-all`

*Headers*: `Authorization: Bearer <token>`

*Response* (200 OK):
[source,json]
----
{
  "marked_count": 5
}
----

== 10. Request/Response Conventions

=== 10.1 Common HTTP Status Codes

[cols="1,2,2"]
|===
| Code | Meaning | Usage

| 200
| OK
| Successful GET, PUT, PATCH

| 201
| Created
| Successful POST (resource created)

| 204
| No Content
| Successful DELETE

| 400
| Bad Request
| Invalid request data

| 401
| Unauthorized
| Missing or invalid authentication

| 403
| Forbidden
| Insufficient permissions

| 404
| Not Found
| Resource doesn't exist

| 409
| Conflict
| Resource already exists

| 422
| Unprocessable Entity
| Validation errors

| 429
| Too Many Requests
| Rate limit exceeded

| 500
| Internal Server Error
| Server error
|===

=== 10.2 Error Response Format

[source,json]
----
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation failed",
    "details": [
      {
        "field": "email",
        "message": "Invalid email format"
      },
      {
        "field": "password",
        "message": "Password must be at least 8 characters"
      }
    ]
  }
}
----

=== 10.3 Pagination Format

[source,json]
----
{
  "data": [...],
  "meta": {
    "page": 1,
    "per_page": 20,
    "total_items": 45,
    "total_pages": 3
  },
  "links": {
    "self": "/api/v1/resource?page=1",
    "first": "/api/v1/resource?page=1",
    "prev": null,
    "next": "/api/v1/resource?page=2",
    "last": "/api/v1/resource?page=3"
  }
}
----

=== 10.4 Timestamp Format

* All timestamps in ISO 8601 format with UTC timezone
* Example: `2026-01-18T16:30:00Z`

=== 10.5 ID Format

* All IDs are UUIDs (version 4)
* Example: `550e8400-e29b-41d4-a716-446655440000`

== 11. Authentication & Authorization

=== 11.1 JWT Token Structure

[source,json]
----
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "sub": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "username": "johndoe",
    "exp": 1640000000,
    "iat": 1639900000,
    "scopes": ["user"]
  }
}
----

=== 11.2 Authorization Header

[source]
----
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
----

=== 11.3 Permission Scopes

[cols="1,3"]
|===
| Scope | Permissions

| `user`
| Read own profile, update own profile, create projects, request contributions

| `project_owner`
| Manage own projects, approve/reject contributions

| `admin`
| Full access to all resources
|===

== 12. Rate Limiting

=== 12.1 Rate Limit Rules

* *Anonymous requests*: 60 requests per hour
* *Authenticated requests*: 1000 requests per hour
* *Create operations*: 100 per hour

=== 12.2 Rate Limit Headers

[source]
----
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1640000000
----

=== 12.3 Rate Limit Exceeded Response

*Status*: 429 Too Many Requests

[source,json]
----
{
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Rate limit exceeded. Try again in 30 minutes.",
    "retry_after": 1800
  }
}
----

== 13. API Versioning

=== 13.1 Versioning Strategy

* URL path versioning: `/api/v1`, `/api/v2`
* Major version for breaking changes
* Maintain previous version for 6 months after new version release
* Deprecation warnings in response headers

=== 13.2 Deprecation Header

[source]
----
Deprecation: true
Sunset: Sat, 01 Jul 2026 00:00:00 GMT
Link: </api/v2/resource>; rel="successor-version"
----

== 14. API Documentation

=== 14.1 OpenAPI/Swagger

* Auto-generated from FastAPI application
* Available at `/api/docs` (Swagger UI)
* Available at `/api/redoc` (ReDoc)
* OpenAPI schema at `/api/openapi.json`

=== 14.2 Interactive Documentation

FastAPI automatically generates:
* Interactive API explorer
* Request/response examples
* Schema definitions
* Authentication testing

== 15. CORS Configuration

=== 15.1 Allowed Origins

* Development: `http://localhost:3000`
* Production: `https://ossnetwork.com`

=== 15.2 CORS Headers

[source]
----
Access-Control-Allow-Origin: https://ossnetwork.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Max-Age: 86400
----

== 16. References

* FastAPI Documentation: https://fastapi.tiangolo.com/
* OpenAPI Specification: https://swagger.io/specification/
* REST API Best Practices: https://restfulapi.net/

== Appendix: Related Documents

* link:system-architecture.adoc[System Architecture Document]
* link:component-architecture.adoc[Component Architecture Document]
* link:security-architecture.adoc[Security Architecture Document]

---
_Document Version: 1.0_ +
_Last Updated: 2026-01-18_ +
_Status: Initial Release_
